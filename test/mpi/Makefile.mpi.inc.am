if MPI_SUPPORTED
check_PROGRAMS += mpitest

mpitest_SOURCES =  $(SRC_ROOT)/test/mpi/mpitest.c
mpitest_CPPFLAGS = $(AM_CPPFLAGS)           \
    -I$(INC_ROOT)src/adapters/include       \
    -I$(INC_ROOT)src/measurement/include    \
    -I$(INC_DIR_UTIL)
mpitest_LDADD = \
    $(LIB_DIR_SCOREP)libscorep_mpi.la \
    $(LIB_DIR_SCOREP)libscorep_pomp_dummy.la \
    $(LIB_DIR_OTF2)libotf2.la \
    $(LIB_DIR_UTIL)libscorep_utilities.la
if HAVE_PAPI
mpitest_LDFLAGS = $(SCOREP_PAPI_LDFLAGS) $(SCOREP_PAPI_LIBS) -Wl,-rpath,$(SCOREP_PAPI_LIBDIR)
endif

check_PROGRAMS += test_link

test_link_SOURCES =  $(SRC_ROOT)/test/mpi/test_link.c 
test_link_CPPFLAGS = $(AM_CPPFLAGS)           \
    -I$(INC_ROOT)src/adapters/include       \
    -I$(INC_ROOT)src/measurement/include    \
    -I$(INC_DIR_UTIL)
test_link_LDADD = \
    $(LIB_DIR_SCOREP)libscorep_mpi.la \
    $(LIB_DIR_SCOREP)libscorep_pomp_dummy.la \
    $(LIB_DIR_OTF2)libotf2.la \
    $(LIB_DIR_UTIL)libscorep_utilities.la \
    -lm
if HAVE_PAPI
test_link_LDFLAGS = $(SCOREP_PAPI_LDFLAGS) $(SCOREP_PAPI_LIBS) -Wl,-rpath,$(SCOREP_PAPI_LIBDIR)
endif


check_PROGRAMS += mpi_hello_world
mpi_hello_world_SOURCES =  $(SRC_ROOT)/test/mpi/mpi_hello_world.c 
mpi_hello_world_LDADD =                 \
    $(LIB_DIR_SCOREP)libscorep_mpi.la \
    $(LIB_DIR_OTF2)libotf2.la           \
    $(LIB_DIR_UTIL)libscorep_utilities.la \
    -lm
if HAVE_PAPI
mpi_hello_world_LDFLAGS = $(SCOREP_PAPI_LDFLAGS) $(SCOREP_PAPI_LIBS) -Wl,-rpath,$(SCOREP_PAPI_LIBDIR)
endif

TESTS_MPI += mpi_hello_world

check_PROGRAMS += mpi_hello_world_uninstrumented
mpi_hello_world_uninstrumented_SOURCES =  $(SRC_ROOT)/test/mpi/mpi_hello_world.c 

check_PROGRAMS += metric_on_one_rank_only_test
metric_on_one_rank_only_test_SOURCES = \
    $(SRC_ROOT)/test/mpi/metric_on_one_rank_only_test.c

metric_on_one_rank_only_test_CPPFLAGS = $(AM_CPPFLAGS) \
    -I$(INC_ROOT)src/adapters/include       \
    -I$(INC_ROOT)src/measurement/include    \
    -I$(PUBLIC_INC_DIR)                     \
    -I$(INC_DIR_UTIL)                       \
    -DSCOREP_USER_ENABLE

metric_on_one_rank_only_test_LDADD =      \
    $(LIB_DIR_SCOREP)libscorep_mpi.la     \
    $(LIB_DIR_OTF2)libotf2.la             \
    $(LIB_DIR_UTIL)libscorep_utilities.la \
    -lm

TESTS_MPI += metric_on_one_rank_only_test

endif
